---
classes:
  - apt
  - hostbase::autoupdate
  #  - hostbase::disable_cloud
  - hostbase::dotfiles
  - hostbase::github_userkeys
  - hostbase::puppet
  - hostbase::puppet_cron
  - hostbase::resolved
  - hostbase::sshd
  - hostbase::syslog
  - timezone
  - docker
  - telegraf

hostbase::puppet::version: 6.13.0-1bionic

hostbase::packages::base_packages:
  - mailutils
  - vim-nox
  - git
  - python3-virtualenv
  - python3-pip
  - hwinfo

github_userkeys:
  "marco": gentoomaniac
  "root": gentoomaniac

timezone::timezone: Etc/UTC

dns::servers:
  - 10.1.1.52
  - 10.1.1.53

apt::sources:
  "puppet6":
    location: http://apt.puppetlabs.com
    release: "%{facts.os.distro.codename}"
    repos: puppet6
    key:
      id: "6F6B15509CF8E59E6E469F327F438280EF8D349F"
      server: keyserver.ubuntu.com
  "elasticsearch7x":
    location: https://artifacts.elastic.co/packages/7.x/apt
    release: stable
    repos: main
    key:
      id: "46095ACC8548582C1A2699A9D27D666CD88E42B4"
      server: keyserver.ubuntu.com

ressources:
  group:
    "marco":
      ensure: present
      gid: 1000
      before: User[marco]
  user:
    "ubuntu":
      ensure: absent
      before: User[marco]
    "marco":
      ensure: present
      uid: 1000
      gid: marco
      home: /home/marco
      shell: /bin/bash
      managehome: true
      password: $6$OyX.KXb2$G8HSC0zSuuSpywQkq.8mZ0JSnt84MNdwrt.AqLiEmyxh7I4R9Ni/N1P8yq/lDVZF9ysFxAkB4gQP7Qm93A9TL0
      groups:
        - sudo
        - adm
      purge_ssh_keys: true
  file:
    "/srv":
      ensure: directory

docker::docker_users:
  - marco
  - telegraf

telegraf::hostname: "%{::fqdn}"
telegraf::global_tags:
  role: "%{::role}"
  domain: "%{::domain}"
telegraf::inputs:
  cpu:
    - percpu: true
      totalcpu: true
  exec:
    - commands:
        - who | wc -l
    - commands:
        - cat /proc/uptime | awk '{print $1}'
  mem: [{}]
  io: [{}]
  net: [{}]
  disk: [{}]
  swap: [{}]
  system: [{}]
  docker:
    - endpoint: unix:///var/run/docker.sock
telegraf::outputs:
  influxdb:
    - urls:
        - "https://influxdb.srv.gentoomaniac.net:8086"
      database: 'telegraf'
      username: "%{lookup('secret_telegraf_user')}"
      password: "%{lookup('secret_telegraf_password')}"
