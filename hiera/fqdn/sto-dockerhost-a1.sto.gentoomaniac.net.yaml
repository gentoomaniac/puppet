---
classes:
  - logstash_docker
  - tftpd
  - kickstart_nginx

ressources:
  sysctl:
    "vm.max_map_count":
      value: 262144

netplan::version: 2
netplan::renderer: networkd
netplan::ethernets:
  enp0s25:
    dhcp4: no
    addresses:
      - 10.1.1.3/24
    nameservers:
      search: [gentoomaniac.net]
      addresses: [10.1.1.52, 10.1.1.53]
    routes:
      - to: 0.0.0.0/0
        via: 10.1.1.1
        metric: 10

kickstart_nginx::labels:
  - "'traefik.enable=true'"
  - "'traefik.http.routers.ksnginx.entrypoints=web'"
  - "'traefik.http.routers.ksnginx.rule=Host(`ks.srv.gentoomaniac.net`)'"
  - "'traefik.http.routers.ksnginx-secure.entrypoints=websecure'"
  - "'traefik.http.routers.ksnginx-secure.rule=Host(`ks.srv.gentoomaniac.net`)'"
  - "'traefik.http.routers.ksnginx-secure.tls=true'"
  - "'traefik.http.routers.ksnginx-secure.tls.certresolver=http'"
  - "'traefik.http.routers.ksnginx-secure.service=ksnginx'"
  - "'traefik.http.services.ksnginx.loadbalancer.server.port=80'"
  - "'traefik.http.middlewares.ks-nginx.ipwhitelist.sourcerange=10.1.1.0/24,10.1.15.0/24'"
