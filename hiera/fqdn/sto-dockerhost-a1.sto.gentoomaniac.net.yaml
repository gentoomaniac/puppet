---
classes:
  - logstash_docker
  - tftpd
  - kickstart_nginx
  - tautulli
  - portainer
  - docker_registry
  - ioquake3
  - docker::volumes

ressources:
  sysctl:
    "vm.max_map_count":
      value: 262144

netplan::version: 2
netplan::renderer: networkd
netplan::ethernets:
  enp0s25:
    dhcp4: no
    addresses:
      - 10.1.1.3/24
    nameservers:
      search: [gentoomaniac.net]
      addresses: [10.1.1.52, 10.1.1.53]
    routes:
      - to: 0.0.0.0/0
        via: 10.1.1.1
        metric: 10

docker::volumes::volumes:
  nfs_movies:
    ensure: present
    driver: local
    options:
      - - type=nfs
        - o=addr=10.1.1.5,nolock,soft,bg,tcp,intr,rsize=8192,wsize=8192,noatime,rw
        - device=:/mnt/movies/movies
  nfs_kids_movies:
    ensure: present
    driver: local
    options:
      - - type=nfs
        - o=addr=10.1.1.5,nolock,soft,bg,tcp,intr,rsize=8192,wsize=8192,noatime,rw
        - device=:/mnt/tank0/kids_movies
  nfs_shows:
    ensure: present
    driver: local
    options:
      - - type=nfs
        - o=addr=10.1.1.5,nolock,soft,bg,tcp,intr,rsize=8192,wsize=8192,noatime,rw
        - device=:/mnt/tank3/shows
  nfs_kids_shows:
    ensure: present
    driver: local
    options:
      - - type=nfs
        - o=addr=10.1.1.5,nolock,soft,bg,tcp,intr,rsize=8192,wsize=8192,noatime,rw
        - device=:/mnt/tank0/kids_shows
  nfs_kids_shows_se:
    ensure: present
    driver: local
    options:
      - - type=nfs
        - o=addr=10.1.1.5,nolock,soft,bg,tcp,intr,rsize=8192,wsize=8192,noatime,rw
        - device=:/mnt/tank0/kids_shows_se
  nfs_sd_old:
    ensure: present
    driver: local
    options:
      - - type=nfs
        - o=addr=10.1.1.5,nolock,soft,bg,tcp,intr,rsize=8192,wsize=8192,noatime,rw
        - device=:/mnt/tank3/sd_old

kickstart_nginx::labels:
  - "'traefik.enable=true'"
  - "'traefik.http.routers.ksnginx.rule=Host(`ks.srv.gentoomaniac.net`)'"
  - "'traefik.http.routers.ksnginx.entrypoints=websecure'"
  - "'traefik.http.routers.ksnginx.tls=true'"
  - "'traefik.http.middlewares.ksnginx-whitelist.ipwhitelist.sourcerange=10.1.1.0/24,10.1.15.0/24'"
  - "'traefik.http.routers.ksnginx.middlewares=ksnginx-whitelist'"

tautulli::labels:
  - "'traefik.enable=true'"
  - "'traefik.http.routers.tautulli.rule=Host(`tautulli.srv.gentoomaniac.net`)'"
  - "'traefik.http.routers.tautulli.entrypoints=websecure'"
  - "'traefik.http.routers.tautulli.tls=true'"
  - "'traefik.http.middlewares.tautulli-whitelist.ipwhitelist.sourcerange=10.1.1.0/24,10.1.15.0/24'"
  - "'traefik.http.routers.tautulli.middlewares=tautulli-whitelist'"

portainer::labels:
  - "'traefik.enable=true'"
  - "'traefik.http.routers.portainer.rule=Host(`portainer.srv.gentoomaniac.net`)'"
  - "'traefik.http.routers.portainer.entrypoints=websecure'"
  - "'traefik.http.routers.portainer.tls=true'"
  - "'traefik.http.middlewares.portainer-whitelist.ipwhitelist.sourcerange=10.1.1.0/24,10.1.15.0/24'"
  - "'traefik.http.routers.portainer.middlewares=portainer-whitelist'"

docker_registry::labels:
  - "'traefik.enable=true'"
  - "'traefik.http.routers.registry.rule=Host(`registry.srv.gentoomaniac.net`)'"
  - "'traefik.http.routers.registry.entrypoints=websecure'"
  - "'traefik.http.routers.registry.tls=true'"
  - "'traefik.http.middlewares.registry-whitelist.ipwhitelist.sourcerange=10.1.1.0/24,10.1.15.0/24'"
  - "'traefik.http.routers.registry.middlewares=registry-whitelist'"
